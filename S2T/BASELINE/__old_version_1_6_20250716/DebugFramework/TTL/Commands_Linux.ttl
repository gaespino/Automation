; Send command to EFI over serial port COM8
; Open the serial port
connect '/C=8 /BAUD=115200'
timeout = 10
;logopen 'C:\Temp\capture.log'

sendln 'fs1:'
mpause 100

; Send the command to boot
sendln 'bootlinux.nsh'

; Wait for 10 seconds
pause 10

; Wait for the connection to establish
:check
wait 'Press any key to continue...' 'GRUB version' '--MORE--' 'PROCESS'
if result=0 goto error
if result=1 goto moreset
if result=2 goto nextos
if result=3 goto moreset
if result=4 goto startlogin

:moreset
sendln ''
goto check

:nextos
; Navigate the OS option window
; Assuming the Linux OS is the second option, send the down arrow key
sendkcode 336 1
pause 3 ; Wait for 3 second
sendln ''

:startlogin

include 'Connect.ttl'

; Wait for OS to be connected over SSH
wait '#CONNECTED'
if result=0 goto error
if result=1 goto content

:content
include 'LinuxContent.ttl'

wait 'Test Complete' 'Result=SUCCESS'
if result=0 goto error
if result=1 goto finishtest
if result=2 goto finishtest

:error
sendln '#Test Failed'
end

:finishtest
sendln '#Test Pass'
end